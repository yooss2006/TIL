# 클로저

참조

- 모던자바스크립트 딥다이브
- https://ko.javascript.info/

 </br>

### 클로저는 함수와 그 함수가 선언된 렉시컬 환경의 조합이다.

😂 말이 너무 어렵다. 렉시컬 스코프부터 알아보자.

 </br>

## 렉시컬 스코프

자바스크립트 엔진은 함수를 **어디에서 정의**했는지에 따라 상위 스코프를 결정한다.
이를 **렉시컬 스코프**라고 한다.

```jsx
const x = 1;
function outer() {
  const x = 20;
  function iner() {
    console.log(x); //결과 20;
  }
  iner();
}
outer();
```

위 예제를 보게되면 함수가 중첩되어 있다. iner 함수가 선언된 위치는 outer 함수 안이라 iner함수의 상위스코프는 outer가 된다.

iner 함수의 바깥쪽에서 선언되었다면 상위스코프는 전역이 되었을 것 이다.

<br/>

## `[[Environment]]`

함수는 자신의 정의된 환경 (상위스코프)를 기억할 필요가 있다.

- 내부슬롯 `[[Environment]]`에 상위 스코프의 참조를 저장한다

 </br>
 
## 클로저

외부함수보다 중첩함수가 더 오래 유지되는 경우 중첩함수는 생명주기가 종료된 외부함수의 변수를 참조할 수 있다. 이것이 **클로저**이다.

이것이 가능한 이유

1. 중첩 함수가 평가되는 시점에 상위 스코프인 외부 함수의 렉시컬 환경을 `[[Environment]]` 에 저장한다.
2. 외부 함수의 생명주기가 종료되고 실행컨텍스트 스택에서 제거되지만 외부 함수의 렉시컬 환경까지 소멸되진 않는다.

- - 그 이유는 가비지컬렉터는 누군가 참조하고 있는 메모리 공간을 해체하지 않기 때문이다.

3. 중첩 함수가 호출되었을 때 `[[Environment]` 안의 값인 외부 함수의 렉시컬 환경을 이용하기에 상위 스코프의 식별자를 기억해 낼 수 있다.

 </br>

### 클로저의 조건

자바스크립트의 모든 함수는 상위 스코프를 기억한다. 하지만 모두가 클로저인 것은 아니다.

클로저가 되기위한 조건은

- 중첩된 함수가 상위 스코프의 식별자를 참조해야한다.
  - 클로저에 의해 참조되는 상위스코프의 변수를 자유변수라고 한다.
    - 브라우저는 메모리 관리를위해 자유변수만을 기억하고 나머진 잊어버린다.
- 중첩된 함수가 외부로 반환되지 않아 외부 함수보다 일찍소멸하면 클로저가 아니다.

> **결론 : 클로저는 중첩함수가 상위 스코프의 식별자를 참조하고 잇고 중첩함수가 외부 함수보다 더 오래 유지되는 경우에 한정된다.**

</br>

### 클로저의 용도

</br>

- **상태를 안전하게 변경하고 유지하기 위해 사용한다.**

특정 함수에게만 상태변경을 허용할 수 있게해 의도치않게 상태가 변경되는 것을 막는다.

예를들어

- 전역변수를 통해 상태를 관리하므로 수정될 가능성이 크지만 클로저를 사용하게되면 이러한 사태를 예방할 수 있다.

  - 즉시실행함수와 클로저 에시를 들어보겠다.

    ```jsx
    let increase = (function () {
      //즉시실행함수 사용, 반환된 함수가 increase 변수에 저장
      let num = 0;
      return function () {
        //즉시실행함수의 렉시컬 환경을 기억
        return ++num;
      };
    })();
    console.log(increase());
    ```

1. 즉시실행 함수는 실행즉시 소멸되지만 반환된 함수는 소멸되지않고 increase 변수에 저장된다.

2. 즉시 실행함수의 렉시컬 환경 increase는 기억한다. 이처럼 클로저를 사용하면 즉시 실행함수의 렉시컬 환경을 참조할 수 있다.

3. **따라서 increase를 통해서만 num 값을 증가시킬 수 있게된다.**

</br>

- **캡슐화와 정보은닉에 사용된다**

캡슐화 : 객체의 프로퍼티와 메서드를 묶는 것을 의미한다.
특정 프로퍼티와 메서드를 감추는 정보은닉으로도 사용할 수 있다.

객체에서 캡슐화는 프로퍼티로 생성시 모두가 사용가능하고 지역변수로써 선언시 은닉이 가능하다.

> 느낀점 : 클로저라는 개념을 어렵다고만 생각했었는데 (여전히 어렵지만::) 그래도 좀 더 잘 알게된 것 같습니다. 수정할 내용이나 추가할 내용이 생기면 바로바로 추가하겠습니다.
